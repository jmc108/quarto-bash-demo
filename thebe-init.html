<script>
window.addEventListener('load', () => {
  // Tag Quarto/Pandoc code blocks that are Bash
  document.querySelectorAll('div.sourceCode').forEach((block) => {
    const code = block.querySelector('code.language-bash, code.bash, code.sourceCode.bash');
    const pre  = block.querySelector('pre');
    if (!code || !pre) return;

    pre.setAttribute('data-executable', 'true');
    pre.setAttribute('data-language', 'bash');

    // Ensure an output area immediately after the code block
    const next = block.nextElementSibling;
    const needsOutput = !(next && next.classList && next.classList.contains('output'));
    if (needsOutput) {
      const out = document.createElement('div');
      out.className = 'output';
      block.insertAdjacentElement('afterend', out);
    }
  });
});
</script>


<script>
// Bind Enter→run, Shift+Enter→newline once Thebe is ready
function bindEnterToRun() {
  document.querySelectorAll('.thebelab-input .CodeMirror').forEach((el) => {
    const cm = el.CodeMirror;
    if (!cm || cm.__enterBound) return;
    cm.__enterBound = true;

    cm.addKeyMap({
      "Enter": function() {
        const cell = el.closest('.thebelab-cell, .cell');
        const runBtn = cell && cell.querySelector('[title="Run"], .thebe-run-button, .thebelab-run-button');
        if (runBtn) runBtn.click();
      },
      "Shift-Enter": function(cm) { cm.replaceSelection('\n'); }
    });
  });
}

// Re-bind once the kernel is actually connected
document.addEventListener('thebe-status', (e) => {
  if (e && e.detail && e.detail.status === 'ready') {
    setTimeout(bindEnterToRun, 200);  // give DOM a breath
  }
});
</script>
